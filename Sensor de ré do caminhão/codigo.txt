//Programa: Sensor de ré para o caminhão
//Autor: Carlos Alberto Silva Júnior
//Download da biblioteca do sensor Ultrasonic HC-SR04: https://github.com/filipeflop/Ultrasonic
 
//Carrega a biblioteca do sensor ultrassonico
#include <Ultrasonic.h>
 
//Define os pinos para o trigger e echo do sensor Ultrsonico
#define pino_trigger 4
#define pino_echo 5
//PINO DIGITAL EM QUE O BUZZER ESTÁ CONECTADO
#define pinoBuzzer 2

//Inicializa o sensor nos pinos definidos acima
Ultrasonic ultrasonic(pino_trigger, pino_echo);
 
void setup()
{
  //Imprime no Monitor Serial
  Serial.begin(9600);
  Serial.println("Lendo dados do sensor...");
  //Define a porta do led como saida
  pinMode(11, OUTPUT);
}
 
void loop()
{
  //Le as informacoes do sensor, em cm e pol
  float cmMsec, inMsec;
  long microsec = ultrasonic.timing();
  cmMsec = ultrasonic.convert(microsec, Ultrasonic::CM);
  inMsec = ultrasonic.convert(microsec, Ultrasonic::IN);
  //Exibe informacoes no serial monitor
  Serial.print("Distancia em cm: ");
  Serial.print(cmMsec);
  Serial.print(" - Distancia em polegadas: ");
  Serial.println(inMsec);
  delay(500);
  // SE A DISTÂNCIA ENTRE O OBJETO E O SENSOR ULTRASONICO FOR MENOR QUE 20CM, FAZ
  if(cmMsec <= 20){
  tone(pinoBuzzer,1500);//ACIONA O BUZZER
  //Acende o led
  digitalWrite(11, HIGH);
  delay(250);
  //BUZZER PERMANECE DESLIGADO
  noTone(pinoBuzzer);
  //Apaga o led
  digitalWrite(11, LOW);
  Serial.print("Menor que 20");  
  }else{//SENÃO, FAZ
  noTone(pinoBuzzer);
  //Apaga o led
  digitalWrite(11, LOW);
  }
  // SE A DISTÂNCIA ENTRE O OBJETO E O SENSOR ULTRASONICO FOR MENOR QUE 8CM, FAZ
  if(cmMsec <= 8 ){
  tone(pinoBuzzer,1500);//ACIONA O BUZZER
  Serial.print("Menor que 8");
  //Acende o led
  digitalWrite(11, HIGH);
  }
}